<!DOCTYPE html>
<html>
<head>
  <title>Our Project Website</title>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css"/>
  <script type='text/javascript' src='//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js'></script>
  <script type='text/javascript' src='https://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js'></script>
</head>

<body onload="logData()">
  <div class='topbar'>
    <a href='./#'>PG FOODS</a>
    <div class = 'barright'>
      <a href='./about/'>About</a>
      <a href='./establishments/'>Establishments</a>
      <a href='./statistics/'>Statistics</a>
      <a href='./faqs/'>FAQs</a>
    </div>
  </div>

  <div class='head'>
    <h1>PG Foods</h1>
    <em>Dedicated to encouraging informed Prince George's county food decisions</em>
    <br>
  </div>

  <br>
  <div class='content'>
    <div class='wrapper'>
      <br>
      <div class='search-container'>
        <input type='text' placeholder='search' name='search'>
        <button type="submit"><i class="fa fa-search"></i></button>
      </div>

      <br>
      <div id='tab'>Establishments</div>
      <div id="map" style="height: 440px; border: 1px solid #AAA;"></div>
      <script type='text/javascript' src='markers.json'></script>
      <script type='text/javascript' src='leaf-demo.js'></script>

      <button class="button" onclick="loadData()">Load Some JSON from a server</button>
      <ul class='templist'></ul>
    </div>
  </div>
  <script>
    function loadData() {
      console.log('fetch'); // confirm code is running on click
      fetch('/allEstablishments')
        .then(res => res.json())
        .then(res => {
          var string = '';
          //console.log(res); // logging step to check what we got
          var d = res.data;
          for (i in d) {
            let t = d[i];
            //console.log(res[i]);
            string += '<li>'+t.establishment_id+', <a onClick=establishmentClick(\'' + t.establishment_id + '\')>'+t.name+'</a></li>';
          }
          document.querySelector(".templist").innerHTML = '<ol>'+string+'</ol>';
          return res;
        });
    }

    function establishmentClick(id){
      fetch('/establishmentId', {
        method: 'post',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({establishmentId: id})
      })
        .then(res => {
          console.log(res.status);
          //window.location.href = 'http://localhost:8080/establishments/';
          window.location.href = 'https://pg-foods.herokuapp.com/establishments';
        });
    }
    function logData(){
      fetch('/allEstablishments')
        .then(res => {
          console.log(res.status);
          console.log(res.json());
          return res.json();
        })
        .catch((err) => {
          console.log(err);
        });
    }
    function testPost(){
      fetch('/establishmentId', {
        method: 'post',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({id: '1'})
      })
        .then(res => {
          console.log(res.status);
          return res.json();
        });
    }
  </script>
</body>
</html>
